#!/usr/bin/env bash
set -e

# Define variables for arguments
reviewer=""
message=""
branch=""

# Check if required variables are set
if [[ -z "$reviewer" ]]; then
  echo "Error: Reviewer is not specified." >&2
  exit 1
fi

if [[ -z "$message" ]]; then
  echo "Error: Message is not specified." >&2
  exit 1
fi

# Execute gh-prciwatch with arguments and capture output and exit code
output=""
exit_code=0

output=$(gh prciwatch -reviewer="$reviewer" -message="$message" -branch="$branch" 2>&1) || exit_code=$?

# Copy output to clipboard
echo "$output" | pbcopy

# Notify using terminal-notifier
case $exit_code in
  0)
    terminal-notifier -title "CI Check Passed" -message "Success: $output" -sound default
    ;;
  1)
    terminal-notifier -title "CI Check Failed" -message "Failure: $output" -sound default
    ;;
  2)
    terminal-notifier -title "CI Check Timeout" -message "Timeout: CI checks did not complete in time.\n$output" -sound default
    ;;
  *)
    terminal-notifier -title "CI Check Error" -message "Error: Unexpected error occurred. Exit code: $exit_code\n$output" -sound default
    ;;
esac

exit $exit_code

